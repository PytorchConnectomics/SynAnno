{% extends "templatebase.html" %}

{% block help_content %}
<p class="text-muted">
  {% if mode == 'draw'%}
  Select an h5 source, h5 target, and JSON file and click "Submit". When the data was submitted successfully, click "Start Data
  Proofread." The JSON must fit the data perfectly and can not deviate from the predefined format, i.e., it must have been
  generated by this tool.
  {% elif mode == 'annotate'%}
  Select an h5 source and target file and click "Submit". When the data was submitted successfully, click "Start Data
  Proofread."
  If you have already proofread the dataset, you can also upload the annotation JSON. However, this JSON must fit the
  data perfectly and can not deviate from the predefined format, i.e., it must have been generated by this tool.
  {% endif %}


</p>
{% endblock %}

{% block content %}

<script src="https://cdn.socket.io/4.4.1/socket.io.min.js"
  integrity="sha384-fKnu0iswBIqkjxrhQCTZ7qlLHOFEgNkRmK2vaO/LbTZSXdJfAu6ewRBdwHPhBo/H" crossorigin="anonymous"></script>


<div class="px-4 py-3 my-3 text-center">
  <h2 class="mb-3"> Welcome to SynAnno Annotation Tool</h2>
  <p>{% if mode == 'draw'%}Select target, source and JSON to start annotating!{% elif mode == 'annotate'%}Select some
    data and start proofreading!{% endif %}</p>
</div>

<div class="mb-3">
  <form method="POST" for="{{ modeform }}" action="{{ url_for('upload_file') }}" enctype="multipart/form-data">
    <label for="formFileMultiple" class="form-label">Source .h5 data file - Required</label>
    <p><input class="form-control" type="file" id="originalFile" name="file_original"></p>
    <label for="formFileMultiple" class="form-label">Target .h5 data file - Required</label>
    <p><input class="form-control" type="file" id="gtFile" name="file_gt"></p>
    <label for="formFileMultiple" class="form-label">SynAnno JSON file {% if mode == 'draw'%}-
      Required{% endif %}</label>
    <p><input class="form-control {{mode}}" type="file" id="formFile" name="file_json"></p>
    <label for="formGroupExampleInput" class="form-label">Patch Size (square)</label>
    <p><input type="text" class="form-control" id="patchsize" placeholder="142" name="patchsize"></p>
    <p class="mt-4">
      <input id="processData" type="submit" class="btn btn-secondary {{ modecurrent }} disabled" value="Submit">
      <a type="button" class="btn btn-primary {{ modenext }}"
        href="{{ url_for('set_data', task=mode, data_name=filename) }}">
        {% if mode == 'draw'%} Start Drawing {% elif mode == 'annotate'%}Start Data Proofread{% endif %}
      </a>
    </p>
    <p>
      <a type="button" id='resetButton' class="btn btn-outline-danger d-{{ modereset or 'none'}}"
        href="{{ url_for('reset') }}">Reset Backend</a>
      <a type="button" id='continueButton' class="btn btn-outline-warning d-{{ modereset or 'none'}}"
        href="{{ url_for('set_data', task=mode, data_name=filename) }}">Continue Previous Task</a>
    </p>
  </form>
</div>

<!-- Modal with progress bar -->
<div class="modal fade" id="progressModal" tabindex="-1" data-bs-backdrop="static" aria-labelledby="exampleModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body">
        <div class="spinner d-flex flex-column align-items-center justify-content-center">
          <div class="row">
            <div class="spinner-border" role="status">
              <span class="sr-only">Loading...</span>
            </div>
          </div>
          <div class="row" id="spinnerText">
            <strong>Loading Source File</strong>
          </div>
        </div>
        <div class="progress d-none">
          <div id="progressBarProcess" class="progress-bar progress-bar-striped progress-bar-animated"
            role="progressbar" aria-valuenow="0 " aria-valuemin="0" aria-valuemax="94"></div>
          <div class="progress-bar-title" id="progressBarText"> </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Script to update the progress bar -->
<script src="{{ url_for('static', filename='progressbar.js') }}"></script>
<!-- add js file to disable the form on reset -->
<script src="{{ url_for('static', filename='opendata.js') }}"></script>

{% endblock %}