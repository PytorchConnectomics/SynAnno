{% extends "templatebase.html" %}

{% block help_content %}
<p class="text-muted">
  {% if mode == 'draw'%}
  Select an h5 source, h5 target, and JSON file and click "Submit". When the data was submitted successfully, click "Start Data
  Proofread." The JSON must fit the data perfectly and can not deviate from the predefined format, i.e., it must have been
  generated by this tool.
  {% elif mode == 'annotate'%}
  Select an h5 source and target file and click "Submit". When the data was submitted successfully, click "Start Data
  Proofread."
  If you have already proofread the dataset, you can also upload the annotation JSON. However, this JSON must fit the
  data perfectly and can not deviate from the predefined format, i.e., it must have been generated by this tool.
  {% endif %}


</p>
{% endblock %}

{% block content %}

<script src="https://cdn.socket.io/4.4.1/socket.io.min.js"
  integrity="sha384-fKnu0iswBIqkjxrhQCTZ7qlLHOFEgNkRmK2vaO/LbTZSXdJfAu6ewRBdwHPhBo/H" crossorigin="anonymous"></script>


<div class="px-4 py-3 my-3 text-center">
  <h2 class="mb-3"> Welcome to SynAnno Annotation Tool</h2>
  <p>{% if mode == 'draw'%}Select target, source and JSON to start annotating!{% elif mode == 'annotate'%}Select some
    data and start proofreading!{% endif %}</p>
</div>

<div class="mb-3">
  
  <form method="POST" for="{{ modeform }}" action="{{ url_for('upload_file') }}" enctype="multipart/form-data">

    <label class="form-check-label">
      <input type="radio" class="form-check-input" name="origin" value="local" {% if origin == 'local' %} checked {% endif %}>
      Local
  </label>
  <label class="form-check-label">
      <input type="radio" class="form-check-input" name="origin" value="cloud" {% if origin == 'cloud' %} checked {% endif %}>
      Cloud
  </label>

  <div class="mb-1"></div>

  <div style="display: flex; justify-content: space-between;">
  <div>
  <label for="formFileMultiple" class="form-label">Resolution (in nm)</label>
  <input class="X-Res." type="number" id="res1" name="res1" placeholder="Default: 8" value=8>
  <input class="Y-Res." type="number" id="res2" name="res2" placeholder="Default: 8" value=8>
  <input class="Z-Res." type="number" id="res3" name="res3" placeholder="Default: 33" value=33>
  </label>
  </div>

  <div>
    <label for="coordinates">Select coordinate order:
      <select id="coordinates" name="coordinates">
          <option value="xyz" selected>  xyz  </option>
          <option value="xzy">  xzy  </option>
          <option value="zyx">  zyx  </option>
          <option value="zxy">  zxy  </option>
          <option value="yxz">  yxz  </option>
          <option value="yzx">  yzx  </option>
      </select>
    </label>
  </div>
</div>

    <div id="local-form" {% if origin == 'cloud' %} class="hidden-form" {% endif %}>
      <label for="formFileMultiple" class="form-label">Source .h5 data file - Required</label>
      <p><input class="form-control" type="file" id="source_file" name="source_file"></p>
      <label for="formFileMultiple" class="form-label">Target .h5 data file - Required</label>
      <p><input class="form-control" type="file" id="target_file" name="target_file"></p>
    </div>
  
    <div id="cloud-form" {% if origin == 'local' %} class="hidden-form" {% endif %}>
    <label for="formFileMultiple" class="form-label">Source bucket (precomputed: Neuroglancer's native format) - Required</label>
    <p><input class="form-control" type="url" id="source_url" name="source_url" placeholder="Cloud Volume Bucket - file://<path_to_your_file>" value='gs://h01-release/data/20210601/c3'></p>
    <label for="formFileMultiple" class="form-label">Target bucket (precomputed: Neuroglancer's native format) - Required</label>
    <p><input class="form-control" type="url" id="target_url" name="target_url" placeholder="Cloud Volume Bucket - file://<path_to_your_file>" value='gs://h01-release/data/20210729/c3/synapses/whole_ei_onlyvol'></p>

    <label class="form-check-label">
        <input type="radio" class="form-check-input" name="view_style" value="view" {% if view_style == 'view' %} checked {% endif %}>
        View Centric
    </label>
    <label class="form-check-label">
        <input type="radio" class="form-check-input" name="view_style" value="neuron" {% if view_style == 'neuron' %} checked {% endif %}>
        Neuron Centric
    </label>

    <div class="mb-1"></div>


      <div id="neuron-form" {% if view_style == 'view' %} class="hidden-form" {% endif %}>
        <label for="formFileMultiple" class="form-label">Materialization (url/name of the table containing the ID association and bounding box information)</label>
        <p><input class="form-control" type="text" id="materialization_url" name="materialization_url" placeholder="Materialization - synapses" value='/Users/lando/Code/SynAnno/h01/synapse-export_000000000000.csv'</p>
        <label for="formFileMultiple" class="form-label">Pre- and postsynaptic IDs</label>
        <div class="number-container">
          <input class="number-dims" type="number" id="preid" name="Presynaptic" placeholder="Presynaptic ID">
          <input class="number-dims" type="number" id="postid" name="Postsynaptic" placeholder="Postsynaptic ID">
        </div>
      </div>
      
      <div id="view-form" {% if view_style == 'neuron' %} class="hidden-form" {% endif %}>
      <label for="formFileMultiple" class="form-label">Slicing indices for the Subvolume</label>
      <div class="coordinate-container">
        <input class="coordinate-dims" type="number" id="x1" name="x1" placeholder="X1 - Default: 0">
        <input class="coordinate-dims" type="number" id="x2" name="x2" placeholder="X2 - Default: max(X)">
        <input class="coordinate-dims" type="number" id="y1" name="y1" placeholder="Y1 - Default: 0">
        <input class="coordinate-dims" type="number" id="y2" name="y2" placeholder="Y2 - Default: max(Y)">
        <input class="coordinate-dims" type="number" id="z1" name="z1" placeholder="Z1 - Default: 0">
        <input class="coordinate-dims" type="number" id="z2" name="z2" placeholder="Z2 - Default: max(Z)">
      </div>
      </div>

      <div class="mb-3"></div>
      <label for="formFileMultiple" class="form-label">Secrets (File containing the bucket secrets, defaults to looking in ~/.cloudvolume/secrets)</label>
      <p><input class="form-control" type="file" id="secrets_file" name="secrets_file"></p>
  </div>

    <label for="formFileMultiple" class="form-label">SynAnno JSON file {% if mode == 'draw'%}-
      Required{% endif %}</label>
    <p><input class="form-control {{mode}}" type="file" id="formFile" name="file_json"></p>
    <label for="formGroupExampleInput" class="form-label">Patch Size (square)</label>
    <p><input type="text" class="form-control" id="patchsize" placeholder="142" name="patchsize"></p>
    <p class="mt-4">
      <input id="processData" type="submit" class="btn btn-secondary {{ modecurrent }} disabled" value="Submit">
      <a type="button" class="btn btn-primary {{ modenext }}"
        href="{{ url_for('set_data', task=mode, view_style=view_style, json_name=json_name) }}">
        {% if mode == 'draw'%} Start Drawing {% elif mode == 'annotate'%}Start Data Proofread{% endif %}
      </a>
    </p>
    <p>
      <a type="button" id='resetButton' class="btn btn-outline-danger d-{{ modereset or 'none'}}"
        href="{{ url_for('reset') }}">Reset Backend</a>
      <a type="button" id='continueButton' class="btn btn-outline-warning d-{{ modereset or 'none'}}"
        href="{{ url_for('set_data', task=mode, view_style=view_style, json_name=json_name) }}">Continue Previous Task</a>
    </p>
  </form>

  
</div>

<!-- Modal with progress bar -->
<div class="modal fade" id="progressModal" tabindex="-1" data-bs-backdrop="static" aria-labelledby="exampleModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body">
        <div class="spinner d-flex flex-column align-items-center justify-content-center">
          <div class="row">
            <div class="spinner-border" role="status">
              <span class="sr-only">Loading...</span>
            </div>
          </div>
          <div class="row" id="spinnerText">
            <strong>Loading Source File</strong>
          </div>
        </div>
        <div class="progress d-none">
          <div id="progressBarProcess" class="progress-bar progress-bar-striped progress-bar-animated"
            role="progressbar" aria-valuenow="0 " aria-valuemin="0" aria-valuemax="94"></div>
          <div class="progress-bar-title" id="progressBarText"> </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Script to update the progress bar -->
<script src="{{ url_for('static', filename='progressbar.js') }}"></script>
<!-- add js file to disable the form on reset -->
<script src="{{ url_for('static', filename='opendata.js') }}"></script>

<script>

</script>

{% endblock %}